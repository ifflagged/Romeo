#!name=å“”å“©å“”å“©
#!desc=æ²¡æœ‰å¹¿å‘Šçš„å“”å“©å“”å“©æ›´å€¼å¾—å¹²æ¯ã€‚
#!author=RuCu6[https://github.com/RuCu6], kokoryh[https://github.com/kokoryh], å¯è‰ğŸ…¥[https://gitlab.com/lodepuly/vpn_tool]
#!icon=https://rucu6.pages.dev/Icons/app/bilibili.png
#!category=Jacob

#!date=2025-12-14 18:30
#!loon_version=3.2.4(787)
#!arguments=displayUpList:"auto",optimizeRequest:true,purifyComment:true,sponsorBlock:true

[Rule]
# ç©ºé™åŠ©æ‰‹
DOMAIN,bsbsb.top,PROXY
AND,((DOMAIN-SUFFIX,chat.bilibili.com),(OR,((DOMAIN-KEYWORD,stun),(DOMAIN-KEYWORD,tracker)))),REJECT
AND,((NOT,((DEST-PORT,8000))),(USER-AGENT,"BilibiliFreedoooooom/MarkII")),REJECT-NO-DROP
# å¤‡ç”¨åŸŸå
DOMAIN,api.biliapi.com,REJECT
DOMAIN,api.biliapi.net,REJECT
DOMAIN,app.biliapi.com,REJECT
DOMAIN,app.biliapi.net,REJECT
# å¼€å±å¹¿å‘Š
URL-REGEX,"^http:\/\/upos-sz-static\.bilivideo\.com\/ssaxcode\/\w{2}\/\w{2}\/\w{32}-1-SPLASH",REJECT-DICT
URL-REGEX,"^http:\/\/[\d\.]+:8000\/v1\/resource\/\w{32}-1-SPLASH",REJECT-DICT

[URL Rewrite]
^https:\/\/api\.bilibili\.com\/pgc\/page\/channel\?(.*)&mobi_app=iphone&(.*)$ https://api.bilibili.com/pgc/page/channel?$1&mobi_app=iphone_i&$2 header
# å¼€å±å¹¿å‘Š
^https:\/\/api\.bilibili\.com\/x\/mengqi\/v1\/resource - reject-dict
^https:\/\/app\.bilibili\.com\/x\/resource\/peak\/download - reject-dict
# æ»¡æ„åº¦è°ƒç ”
^https:\/\/api\.bilibili\.com\/x\/v2\/dm\/qoe\/show\? - reject-dict
# å¤§ä¼šå‘˜å¹¿å‘Š
^https:\/\/api\.bilibili\.com\/x\/vip\/ads\/materials\? - reject-dict
# ç›´æ’­å¹¿å‘Š
^https:\/\/api\.live\.bilibili\.com\/xlive\/e-commerce-interface\/v1\/ecommerce-user\/get_shopping_info\? - reject-dict
# IPè¯·æ±‚ã€åœ°ç†ä½ç½®è¯·æ±‚
^https:\/\/api\.bilibili\.com\/x\/web-interface\/zone\?jsonp - reject-dict
^https:\/\/app\.bilibili\.com\/x\/resource\/ip - reject-dict
# é¦–é¡µæ ‡ç­¾æ çƒ­æ›´æ–°
^https:\/\/app\.bilibili\.com\/x\/resource\/patch\/tab\? - reject-dict
# ç§»é™¤ç›´æ’­é—´é“¾æ¥è·Ÿè¸ªå‚æ•°
(^https:\/\/live\.bilibili\.com\/\d+)(?:\/?\?.*) $1 302
# ç§»é™¤ç›´æ’­é—´æ¸¸æˆæ¨å¹¿
^https:\/\/line3-h5-mobile-api\.biligame\.com\/game\/live\/large_card_material\? - reject-dict
# ç§»é™¤è§†é¢‘é“¾æ¥è·Ÿè¸ªå‚æ•°
(^https:\/\/(?:www|m)\.bilibili\.com\/video\/(?:BV\w{10}|av\d{9}))(?:\/?\?.*) $1 302

[Body Rewrite]
http-response-jq ^https:\/\/api\.bilibili\.com\/pgc\/view\/v2\/app\/season\? 'del(.data.payment)'
http-response-jq ^https:\/\/api\.live\.bilibili\.com\/xlive\/(?:app-interface\/v2\/index\/feed|app-room\/v1\/index\/getInfoBy(?:Room|User))\? '.data |= (del(.play_together_info, .play_together_info_v2, .activity_banner_info) | if .function_card then .function_card[] = null end | if .new_tab_info.outer_list then .new_tab_info.outer_list |= map(select(.biz_id != 33)) end | if .card_list then .card_list |= map(select(.card_type | IN("banner_v2", "activity_card_v1") | not)) end | reduce ([["show_reserve_status"], false], [["reserve_info", "show_reserve_status"], false], [["shopping_info", "is_show"], 0]) as [$path, $value] (.; if getpath($path) then setpath($path; $value) end))'
http-response-jq ^https:\/\/api\.bilibili\.com\/x\/pd-proxy\/tracker\? '.data[][]?="stun.chat.bilibili.com:3478"'
http-response-jq ^https:\/\/app\.bilibili\.com\/x\/resource\/show\/skin\? 'delpaths([["data","common_equip"]])'
http-response-jq ^https:\/\/manga\.bilibili\.com\/twirp\/comic\.v1\.(?:Comic\/AppInit|Home\/HomeFeed)\? '.data as $data | .data[("activity_tab", "flash", "operate") | select($data[.])]=null | if .data.feeds then .data.feeds |= map(select(.type | IN(15, 30) | not)) end'

[Map Local]
# æ’­æ”¾é¡µå¼€é€šä¼šå‘˜çš„æ¨ªå¹…
^https:\/\/api\.bilibili\.com\/pgc\/activity\/deliver\/material\/receive\? data-type=text data="{"code":0,"data":{"closeType":"close_win","container":[],"showTime":""},"message":"success"}" header="Content-Type:text/plain"

# ç§»é™¤å³ä¸Šè§’æ´»åŠ¨å…¥å£
^https:\/\/app\.bilibili\.com\/x\/resource\/top\/activity\? data-type=text data="{"code":-404,"message":"å•¥éƒ½æœ¨æœ‰","ttl":1,"data":null}" header="Content-Type:text/plain"

# æœç´¢æ¡†å¡«å……è¯
^https:\/\/app\.bilibili\.com\/x\/v2\/search\/square\? data-type=text data="{"code":0,"message":"0","ttl":1,"data":{"type":"history","title":"æœç´¢å†å²","search_hotword_revision":2}}" header="Content-Type:text/plain"

# å±è”½é»˜è®¤æœç´¢æ¡†å…³é”®è¯
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.interface\.v1\.Search\/DefaultWords$ data-type=base64 data="AAAAACkaHeaQnOe0ouinhumikeOAgeeVquWJp+aIlnVw5Li7IgAoAToAQgBKAA==" header="Content-Type:text/plain"

# é’å°‘å¹´æ¨¡å¼
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.interface\.v1\.Teenagers\/ModeStatus$ data-type=base64 data="AAAAABMKEQgCEgl0ZWVuYWdlcnMgAioA" header="Content-Type:text/plain"

# æµé‡å¡æ¨è
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.(view\.v1\.View\/TFInfo|viewunite\.v1\.View\/ViewEndPage)$ data-type=base64 data="AAAAAAA=" header="Content-Type:text/plain"

# å“”å“©å“”å“©æ¼«ç”» å¼€å± && åº•æ å¹¿å‘Š
^https:\/\/manga\.bilibili\.com\/twirp\/comic\.v1\.Comic\/(?:Flash|ListFlash|GetActivityTab|GetBubbles) data-type=text data="{"code":0,"msg":"","data":null}" header="Content-Type:text/plain"

[Script]
ç§»é™¤è§†é¢‘å†…æ’æ’­å¹¿å‘Š = type=http-request, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.community\.service\.dm\.v1\.DM\/DmSegMobile$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/request.js, requires-body=true, binary-body-mode=true

ç§»é™¤è¯„è®ºåŒºå¹¿å‘Š = type=http-request, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.main\.community\.reply\.v1\.Reply\/MainList$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/request.js, requires-body=true, binary-body-mode=true, argument=[{{{purifyComment}}}]

ç§»é™¤åŠ¨æ€é¡µé¢å¹¿å‘Š = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.dynamic\.v2\.Dynamic\/DynAll$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true, argument=[{{{displayUpList}}}]

ç§»é™¤çƒ­é—¨è¯é¢˜ = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.show\.v1\.Popular\/Index$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š playview = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.playurl\.v1\.PlayURL\/PlayView$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š playerunite = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.playerunite\.v1\.Player\/PlayViewUnite$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š view = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.view\.v1\.View\/(?:View|ViewProgress)$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š viewunite = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.viewunite\.v1\.View\/(?:RelatesFeed|View|ViewProgress)$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤äº¤äº’å¼å¼¹å¹• = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.community\.service\.dm\.v1\.DM\/DmView$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤æ’­æ”¾å™¨å¼€é€šä¼šå‘˜æ¨ªå¹… = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.pgc\.gateway\.player\.v2\.PlayURL\/PlayView$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

ç§»é™¤æœç´¢ç»“æœå¹¿å‘Š = type=http-response, pattern=^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.polymer\.app\.search\.v1\.Search\/SearchAll$, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/response.js, requires-body=true, binary-body-mode=true

# ä»¥ä¸Šä¸º Proto å¤„ç†, ä»¥ä¸‹ä¸º JSON å¤„ç†
ç§»é™¤è§‚å½±é¡µå¹¿å‘Š = type=http-response, pattern=^https:\/\/api\.bilibili\.com\/pgc\/page\/(?:bangumi|cinema\/tab), script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/json.js, requires-body=true

ç§»é™¤å¼€å±å¹¿å‘Š = type=http-response, pattern=^https:\/\/app\.bilibili\.com\/x\/v2\/splash, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/json.js, requires-body=true

ç²¾ç®€é¦–é¡µé¡¶éƒ¨æ ‡ç­¾ = type=http-response, pattern=^https:\/\/app\.bilibili\.com\/x\/resource\/show\/tab\/v2\?, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/json.js, requires-body=true

ç²¾ç®€æˆ‘çš„é¡µé¢ = type=http-response, pattern=^https:\/\/app\.bilibili\.com\/x\/v2\/account\/mine, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/json.js, requires-body=true

ç§»é™¤é¦–é¡µæ¨èå¹¿å‘Š = type=http-response, pattern=^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index, script-path=https://github.com/ifflagged/Romeo/raw/main/Modules/JS/rucu6/bilibili/json.js, requires-body=true

[MITM]
hostname = %APPEND% *live.bilibili.com, *api.biligame.com, ap?.bilibili.com, grpc.biliapi.net, m.bilibili.com, manga.bilibili.com, www.bilibili.com

