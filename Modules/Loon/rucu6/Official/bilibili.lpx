#!name=å“”å“©å“”å“©
#!desc=æ²¡æœ‰å¹¿å‘Šçš„å“”å“©å“”å“©æ›´å€¼å¾—å¹²æ¯ã€‚
#!author=RuCu6[https://github.com/RuCu6], kokoryh[https://github.com/kokoryh], å¯è‰ğŸ…¥[https://gitlab.com/lodepuly/vpn_tool]
#!icon=https://rucu6.pages.dev/Icons/app/bilibili.png
#!date=2026-02-12 07:55
#!loon_version=3.2.4(787)

[Argument]
displayUpList=select, "auto", "show", "hide", tag=æ˜¾ç¤º åŠ¨æ€ã€Œæœ€å¸¸è®¿é—®ã€, desc=- auto: ä»…å½“åˆ—è¡¨ä¸­å­˜åœ¨ç›´æ’­çŠ¶æ€æ—¶æ˜¾ç¤º\n- show: å§‹ç»ˆæ˜¾ç¤º\n- hide: å§‹ç»ˆéšè—
optimizeRequest=switch, true, false, tag=è¿‡æ»¤ã€Œè§†é¢‘å†…ã€æ’æ’­å¹¿å‘Š, desc=è‡ªåŠ¨è·³è¿‡è§†é¢‘å†…å¹¿å‘Š\n- true: å¼€å¯\n- false: å…³é—­
purifyComment=switch, true, false, tag=è¿‡æ»¤ã€Œè¯„è®ºåŒºã€ç½®é¡¶å¹¿å‘Š, desc=-true: å¼€å¯\n- false: å…³é—­
sponsorBlock=switch, true, false, tag=ç©ºé™åŠ©æ‰‹

[Rule]
# ç©ºé™åŠ©æ‰‹
DOMAIN, bsbsb.top, PROXY
# ç¦ç”¨STUN
AND, ((DOMAIN-SUFFIX, chat.bilibili.com), (OR, ((DOMAIN-KEYWORD, stun), (DOMAIN-KEYWORD, tracker)))), REJECT
# åƒåœ¾CDN
AND, ((NOT, ((DEST-PORT, 8000))), (USER-AGENT, "Bilibili Freedoooooom/MarkII")), REJECT-NO-DROP
# å¤‡ç”¨åŸŸå
DOMAIN, api.biliapi.com, REJECT
DOMAIN, api.biliapi.net, REJECT
DOMAIN, app.biliapi.com, REJECT
DOMAIN, app.biliapi.net, REJECT
# å¼€å±å¹¿å‘Š
URL-REGEX, "^http:\/\/upos-sz-static\.bilivideo\.com\/ssaxcode\/\w{2}\/\w{2}\/\w{32}-1-SPLASH", REJECT-DICT
URL-REGEX, "^http:\/\/[\d\.]+:8000\/v1\/resource\/\w{32}-1-SPLASH", REJECT-DICT

[Rewrite]
# æ’­æ”¾é¡µå¼€é€šä¼šå‘˜çš„æ¨ªå¹…
^https:\/\/api\.bilibili\.com\/pgc\/activity\/deliver\/material\/receive\? mock-response-body data-type=text status-code=200 data="{"code":0,"data":{"closeType":"close_win","container":[],"showTime":""},"message":"success"}"
^https:\/\/api\.bilibili\.com\/pgc\/page\/channel\?(.*)&mobi_app=iphone&(.*)$ header https://api.bilibili.com/pgc/page/channel?$1&mobi_app=iphone_i&$2
^https:\/\/api\.bilibili\.com\/pgc\/view\/v2\/app\/season\? response-body-json-jq 'del(.data.payment)'

# ç›´æ’­é—´
^https:\/\/api\.live\.bilibili\.com\/xlive\/(?:app-interface\/v2\/index\/feed|app-room\/v1\/index\/getInfoBy(?:Room|User))\? response-body-json-jq '.data |= (del(.play_together_info, .play_together_info_v2, .activity_banner_info) | if .function_card then .function_card[] = null end | if .new_tab_info.outer_list then .new_tab_info.outer_list |= map(select(.biz_id != 33)) end | if .card_list then .card_list |= map(select(.card_type | IN("banner_v2", "activity_card_v1") | not)) end | reduce ([["show_reserve_status"], false], [["reserve_info", "show_reserve_status"], false], [["shopping_info", "is_show"], 0]) as [$path, $value] (.; if getpath($path) then setpath($path; $value) end))'

# å¼€å±å¹¿å‘Š
^https:\/\/api\.bilibili\.com\/x\/mengqi\/v1\/resource reject-dict
^https:\/\/app\.bilibili\.com\/x\/resource\/peak\/download reject-dict

# å±è”½STUN
^https:\/\/api\.bilibili\.com\/x\/pd-proxy\/tracker\? response-body-json-jq '.data[][]?="stun.chat.bilibili.com:3478"'

# æ»¡æ„åº¦è°ƒç ”
^https:\/\/api\.bilibili\.com\/x\/v2\/dm\/qoe\/show\? reject-dict

# å¤§ä¼šå‘˜å¹¿å‘Š
^https:\/\/api\.bilibili\.com\/x\/vip\/ads\/materials\? reject-dict

# ç›´æ’­å¹¿å‘Š
^https:\/\/api\.live\.bilibili\.com\/xlive\/e-commerce-interface\/v1\/ecommerce-user\/get_shopping_info\? reject-dict

# IPè¯·æ±‚ã€åœ°ç†ä½ç½®è¯·æ±‚
^https:\/\/api\.bilibili\.com\/x\/web-interface\/zone\?jsonp reject-dict
^https:\/\/app\.bilibili\.com\/x\/resource\/ip reject-dict

# é¦–é¡µæ ‡ç­¾æ çƒ­æ›´æ–°
^https:\/\/app\.bilibili\.com\/x\/resource\/patch\/tab(\/v2)?\? reject-dict

# ç§»é™¤çš®è‚¤æ¨é€
^https:\/\/app\.bilibili\.com\/x\/resource\/show\/skin\? response-body-json-del data.common_equip

# ç§»é™¤å³ä¸Šè§’æ´»åŠ¨å…¥å£
^https:\/\/app\.bilibili\.com\/x\/resource\/top\/activity\? mock-response-body data-type=text status-code=200 data="{"code":-404,"message":"å•¥éƒ½æœ¨æœ‰","ttl":1,"data":null}"

# æœç´¢æ¡†å¡«å……è¯
^https:\/\/app\.bilibili\.com\/x\/v2\/search\/square\? mock-response-body data-type=text status-code=200 data="{"code":0,"message":"0","ttl":1,"data":{"type":"history","title":"æœç´¢å†å²","search_hotword_revision":2}}"

# è¯·æ±‚å¤´å¤„ç†
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.(?:interface\.v1\.(?:Teenagers\/ModeStatus|Search\/DefaultWords)|view\.v1\.View\/TFInfo|viewunite\.v1\.View\/ViewEndPage)$ response-header-add grpc-status 0

# å±è”½é»˜è®¤æœç´¢æ¡†å…³é”®è¯
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.interface\.v1\.Search\/DefaultWords$ mock-response-body data-type=text data="AAAAACkaHeaQnOe0ouinhumikeOAgeeVquWJp+aIlnVw5Li7IgAoAToAQgBKAA==" mock-data-is-base64=true

# é’å°‘å¹´æ¨¡å¼
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.interface\.v1\.Teenagers\/ModeStatus$ mock-response-body data-type=text data="AAAAABMKEQgCEgl0ZWVuYWdlcnMgAioA" mock-data-is-base64=true

# æµé‡å¡æ¨è
^https:\/\/grpc\.biliapi\.net\/bilibili\.app\.(view\.v1\.View\/TFInfo|viewunite\.v1\.View\/ViewEndPage)$ mock-response-body data-type=text data="AAAAAAA=" mock-data-is-base64=true

# ç§»é™¤ç›´æ’­é—´é“¾æ¥è·Ÿè¸ªå‚æ•°
(^https:\/\/live\.bilibili\.com\/\d+)(?:\/?\?.*) 302 $1

# ç§»é™¤ç›´æ’­é—´æ¸¸æˆæ¨å¹¿
^https:\/\/line3-h5-mobile-api\.biligame\.com\/game\/live\/large_card_material\? reject-dict

# ç§»é™¤è§†é¢‘é“¾æ¥è·Ÿè¸ªå‚æ•°
(^https:\/\/(?:www|m)\.bilibili\.com\/video\/(?:BV\w{10}|av\d{9}))(?:\/?\?.*) 302 $1

# å“”å“©å“”å“©æ¼«ç”» å¼€å± && åº•æ å¹¿å‘Š
^https:\/\/manga\.bilibili\.com\/twirp\/comic\.v1\.Comic\/(?:Flash|ListFlash|GetActivityTab|GetBubbles) mock-response-body data-type=text data="{"code":0,"msg":"","data":null}"

# å“”å“©å“”å“©æ¼«ç”» å¹¿å‘Š
^https:\/\/manga\.bilibili\.com\/twirp\/comic\.v1\.(?:Comic\/AppInit|Home\/HomeFeed)\? response-body-json-jq '.data as $data | .data[("activity_tab", "flash", "operate") | select($data[.])]=null | if .data.feeds then .data.feeds |= map(select(.type | IN(15, 30) | not)) end'

[Script]
http-request ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.community\.service\.dm\.v1\.DM\/DmSegMobile$ script-path=https://rucu6.pages.dev/Scripts/bilibili/request.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤è§†é¢‘å†…æ’æ’­å¹¿å‘Š, enable={sponsorBlock}
http-request ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.main\.community\.reply\.v1\.Reply\/MainList$ script-path=https://rucu6.pages.dev/Scripts/bilibili/request.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤è¯„è®ºåŒºå¹¿å‘Š, argument=[{purifyComment}], enable={optimizeRequest}
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.dynamic\.v2\.Dynamic\/DynAll$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤åŠ¨æ€é¡µé¢å¹¿å‘Š, argument=[{displayUpList}]
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.show\.v1\.Popular\/Index$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤çƒ­é—¨è¯é¢˜
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.playurl\.v1\.PlayURL\/PlayView$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š playview
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.playerunite\.v1\.Player\/PlayViewUnite$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š playerunite
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.view\.v1\.View\/(?:View|ViewProgress)$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š view
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.app\.viewunite\.v1\.View\/(?:RelatesFeed|View|ViewProgress)$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤æ’­æ”¾é¡µé¢å¹¿å‘Š viewunite
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.community\.service\.dm\.v1\.DM\/DmView$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤äº¤äº’å¼å¼¹å¹•
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.pgc\.gateway\.player\.v2\.PlayURL\/PlayView$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤æ’­æ”¾å™¨å¼€é€šä¼šå‘˜æ¨ªå¹…
http-response ^https:\/\/(?:app\.bilibili\.com|grpc\.biliapi\.net)\/bilibili\.polymer\.app\.search\.v1\.Search\/SearchAll$ script-path=https://rucu6.pages.dev/Scripts/bilibili/response.js, requires-body=true, binary-body-mode=true, tag=ç§»é™¤æœç´¢ç»“æœå¹¿å‘Š

# ä»¥ä¸Šä¸º Proto å¤„ç†, ä»¥ä¸‹ä¸º JSON å¤„ç†

http-response ^https:\/\/api\.bilibili\.com\/pgc\/page\/(?:bangumi|cinema\/tab) script-path=https://rucu6.pages.dev/Scripts/bilibili/json.js, requires-body=true, tag=ç§»é™¤è§‚å½±é¡µå¹¿å‘Š
http-response ^https:\/\/app\.bilibili\.com\/x\/v2\/splash script-path=https://rucu6.pages.dev/Scripts/bilibili/json.js, requires-body=true, tag=ç§»é™¤å¼€å±å¹¿å‘Š
http-response ^https:\/\/app\.bilibili\.com\/x\/resource\/show\/tab\/v2\? script-path=https://rucu6.pages.dev/Scripts/bilibili/json.js, requires-body=true, tag=ç²¾ç®€é¦–é¡µé¡¶éƒ¨æ ‡ç­¾
http-response ^https:\/\/app\.bilibili\.com\/x\/v2\/account\/mine script-path=https://rucu6.pages.dev/Scripts/bilibili/json.js, requires-body=true, tag=ç²¾ç®€æˆ‘çš„é¡µé¢
http-response ^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index script-path=https://rucu6.pages.dev/Scripts/bilibili/json.js, requires-body=true, tag=ç§»é™¤é¦–é¡µæ¨èå¹¿å‘Š

[MITM]
hostname=*live.bilibili.com, *api.biligame.com, ap?.bilibili.com, grpc.biliapi.net, m.bilibili.com, manga.bilibili.com, www.bilibili.com
